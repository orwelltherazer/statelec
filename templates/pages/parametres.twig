{% extends "base.twig" %}

{% block title %}Param√®tres - Statelec{% endblock %}

{% block content %}
<main class="p-2 sm:p-3 space-y-3">
    <div class="space-y-3">
        <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-6">Th√®me de l'interface</h1>
            <form id="theme-settings-form" class="space-y-4">
                <div>
                    <label for="app_theme" class="block text-sm font-medium mb-2">S√©lectionner un th√®me</label>
                    <select
                        id="app_theme"
                        name="app_theme"
                        class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                    >
                        <option value="HeadLight" {% if settings.app_theme == 'HeadLight' or settings.app_theme is not defined %}selected{% endif %}>Header - Mode clair</option>
                        <option value="HeadDark" {% if settings.app_theme == 'HeadDark' %}selected{% endif %}>Header - Mode sombre</option>
                        <option value="SideLight" {% if settings.app_theme == 'SideLight' %}selected{% endif %}>Sidebar - Mode clair</option>
                        <option value="SideDark" {% if settings.app_theme == 'SideDark' %}selected{% endif %}>Sidebar - Mode sombre</option>
                        <option value="AdmintySide" {% if settings.app_theme == 'AdmintySide' %}selected{% endif %}>üé® Adminty - Sidebar moderne</option>
                    </select>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
                        Choisissez entre une navigation en en-t√™te (Header) ou lat√©rale (Sidebar), en mode clair ou sombre. Le th√®me Adminty offre une interface moderne et color√©e.
                    </p>
                </div>

                <button
                    type="submit"
                    class="w-full bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition font-medium"
                >
                    Enregistrer le th√®me
                </button>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-6">Configuration g√©n√©rale</h2>
            <form id="general-settings-form" class="space-y-4">
                <div>
                    <label for="budgetMensuel" class="block text-sm font-medium mb-2">Budget mensuel (‚Ç¨)</label>
                    <input
                        type="number"
                        id="budgetMensuel"
                        name="budgetMensuel"
                        value="{{ settings.budgetMensuel | default(0) }}"
                        class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                    />
                </div>

                <button
                    type="submit"
                    class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition font-medium"
                >
                    Enregistrer les param√®tres g√©n√©raux
                </button>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-6">Contrat & Abonnement</h2>
            <form id="contract-settings-form" class="space-y-4">
                <div>
                    <label for="subscription_type" class="block text-sm font-medium mb-2">Type de contrat</label>
                    <select
                        id="subscription_type"
                        name="subscription_type"
                        class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                    >
                        <option value="hchp" {% if settings.subscription_type == 'hchp' or settings.subscription_type is not defined %}selected{% endif %}>Heures Pleines / Heures Creuses</option>
                        <option value="base" {% if settings.subscription_type == 'base' %}selected{% endif %}>Base (Tarif unique)</option>
                    </select>
                </div>

                <div>
                    <label for="subscription_price" class="block text-sm font-medium mb-2">Prix de l'abonnement (mensuel ‚Ç¨)</label>
                    <input
                        type="number"
                        step="0.01"
                        id="subscription_price"
                        name="subscription_price"
                        value="{{ settings.subscription_price | default(0) }}"
                        class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                    />
                </div>

                <div id="prices-hchp" class="space-y-4 {% if settings.subscription_type == 'base' %}hidden{% endif %}">
                    <div>
                        <label for="prixHC" class="block text-sm font-medium mb-2">Prix kWh Heures Creuses (‚Ç¨)</label>
                        <input
                            type="number"
                            step="0.0001"
                            id="prixHC"
                            name="prixHC"
                            value="{{ settings.prixHC | default(0.1821) }}"
                            class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                        />
                    </div>

                    <div>
                        <label for="prixHP" class="block text-sm font-medium mb-2">Prix kWh Heures Pleines (‚Ç¨)</label>
                        <input
                            type="number"
                            step="0.0001"
                            id="prixHP"
                            name="prixHP"
                            value="{{ settings.prixHP | default(0.2460) }}"
                            class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                        />
                    </div>
                </div>

                <div id="prices-base" class="space-y-4 {% if settings.subscription_type != 'base' %}hidden{% endif %}">
                    <div>
                        <label for="prixBase" class="block text-sm font-medium mb-2">Prix kWh Base (‚Ç¨)</label>
                        <input
                            type="number"
                            step="0.0001"
                            id="prixBase"
                            name="prixBase"
                            value="{{ settings.prixBase | default(0.2000) }}"
                            class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                        />
                    </div>
                </div>

                <button
                    type="submit"
                    class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition font-medium"
                >
                    Enregistrer le contrat
                </button>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-6">Alerte consommation</h2>
            <form id="alert-settings-form" class="space-y-6">
                <div>
                    <label class="flex items-center gap-2 mb-4">
                        <input
                            type="checkbox"
                            id="email_alerts"
                            name="email_alerts"
                            value="true"
                            {% if settings.email_alerts %}checked="checked"{% endif %}
                            class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                        />
                        <span class="text-sm font-medium">Activer les alertes par email</span>
                    </label>
                    <p class="text-sm text-gray-500 mt-1 mb-4">
                        Recevez des alertes automatiques par email en cas de d√©passement de seuils
                    </p>
                </div>

                <div id="alert-settings-content" class="space-y-6 {% if not settings.email_alerts %}opacity-50 pointer-events-none{% endif %}">
                    <div>
                        <h3 class="text-md font-medium mb-3 text-gray-700 dark:text-gray-300">Seuils d'alerte</h3>
                        <div class="space-y-4 pl-4 border-l-2 border-gray-200 dark:border-gray-600">
                            <div>
                                <label for="seuilPuissance" class="block text-sm font-medium mb-2">Seuil de puissance (W)</label>
                                <input
                                    type="number"
                                    id="seuilPuissance"
                                    name="seuilPuissance"
                                    value="{{ settings.seuilPuissance | default(0) }}"
                                    class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Alerte d√©clench√©e si la puissance d√©passe ce seuil
                                </p>
                            </div>

                            <div>
                                <label for="seuilJournalier" class="block text-sm font-medium mb-2">Seuil journalier (kWh)</label>
                                <input
                                    type="number"
                                    id="seuilJournalier"
                                    name="seuilJournalier"
                                    value="{{ settings.seuilJournalier | default(0) }}"
                                    class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Alerte si la consommation journali√®re d√©passe ce seuil
                                </p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h3 class="text-md font-medium mb-3 text-gray-700 dark:text-gray-300">Configuration des alertes email</h3>
                        <div class="space-y-4 pl-4 border-l-2 border-gray-200 dark:border-gray-600">
                            <div>
                                <label for="email_destinataire" class="block text-sm font-medium mb-2">Email destinataire</label>
                                <input
                                    type="email"
                                    id="email_destinataire"
                                    name="email_destinataire"
                                    value="{{ settings.email_destinataire | default('') }}"
                                    placeholder="votre.email@exemple.com"
                                    class="w-full px-4 py-2 rounded-lg border bg-white border-gray-300 text-gray-900 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Adresse email o√π recevoir les alertes (doit √™tre configur√©e pour le cron)
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <button
                    type="submit"
                    class="w-full bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition font-medium"
                >
                    Enregistrer les alertes
                </button>
            </form>
        </div>


    </div>
</main>
{% endblock %}

{% block scripts %}
<script src="{{ basePath }}js/settings.js"></script>
<script>
    // D√©finir basePath pour le JS externalis√©
    const basePath = "{{ basePath }}";
</script>
{% endblock %}
